# VisualStudio-EmscriptenTools

This project is a major work in progress and may altogether be abandoned if an elegant solution cannot be found. The idea is to be able to redirect build calls through visual studio and pass them off to Emscripten tools. The initial idea and reference material came from the following location: [link](https://github.com/crosire/vs-toolsets). However, this project differs in that it builds its task to do the work and the source for the task is in this repository.

It expects that the [Emscripten SDK](https://github.com/emscripten-core/emsdk) is installed and pointed to by the *`EMSDK`* environment variable. Which will manually have to be added. If normal installation instructions were followed, then EMSDK should point to the _root_ directory and the upstream directory should be located at `$(EMSDK)\upstream`.


## CMake 

The Toolset can be selected either in the GUI or the command line. 
With the GUI select the generator `Visual Studio 16 2019`, then fill in `Emscripten` for the platform generator and `emsdk` for the toolset. Alternatively for the command line, use the -G, -A and -T options respectively.

## ProjectType - Application

Overrides the the standard application `ConfigurationType` tag in the project file then uses the the
EmCxx and EmLink tasks to call emcc.bat and em++.bat on the source file.

The [WAVM](https://github.com/WAVM/WAVM) virtual machine is also referenced internally to execute the output _.wasm_ file with the local windows debugger. WAVM needs to be installed separately and placed in the `$(EMSDK)\upstream\bin` folder.

### CMake 

For executables, it needs to have the suffix property changed in order to correctly output a wasm file.
This is because the `TargetExt` property generated by CMake will be `.exe` 

```cmake
add_executable(<Target> ...)
set_target_properties(<Target> PROPERTIES SUFFIX .wasm)
```
## ProjectType - StaticLibrary

Overrides the the standard application `ConfigurationType` tag in the project file then uses the the
EmCxx and EmAr tasks to build the static library.

## ProjectType - JavaScriptApplication

TODO

## Utilities

### **[clean.bat](clean.bat)**

Calls **python [BuildTools/DeleteFiles.py](BuildTools/DeleteFiles.py)**
The script will load the contents of .gitignore and delete matches from the filesystem.

### **[install.bat](install.bat)**

Calls **python [BuildTools/Install.py](BuildTools/Install.py)**

Which will attempt to copy the task and Toolset directory to the VisualStudio Toolset directory.
It expects that the environment variable `VS2019INSTALLDIR` is defined.

It also accepts test arguments:

+ test01 - Plain MSBuild scripts
+ test02, test03 - CMake generate scripts.
+ test04 Is a manually created project.
